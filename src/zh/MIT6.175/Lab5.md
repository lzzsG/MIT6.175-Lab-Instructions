# 实验 5: RISC-V 引介 - 多周期与两阶段流水线

> 截止日期：2016年10月24日，美东时间晚上11:59:59。
>
> 本实验的交付物包括：
>
> - 在 `TwoCycle.bsv`、`FourCycle.bsv`、`TwoStage.bsv` 和 `TwoStageBTB.bsv` 中完成练习1-4的答案
> - 在 `discussion.txt` 中完成讨论问题1-4的答案

## 引言

本实验介绍了 RISC-V 处理器及其相关工具流。实验从介绍 RISC-V 处理器的单周期实现开始。然后你将创建两周期和四周期的实现，这些实现是由于内存结构危害驱动的。你将完成创建两阶段流水线的实现，使取指和执行阶段并行进行。这种两阶段流水线将成为未来流水线实现的基础。

## 处理器基础设施

在设置运行、测试、评估性能和调试你的 RISC-V 处理器的基础设施方面，已经为你完成了大量工作，无论是在仿真中还是在 FPGA 上。由于使用的内存类型，本实验的处理器设计无法在 FPGA 上运行。

### 初始代码

本实验提供的代码包含三个目录：

- `programs/` 包含 RISC-V 程序的汇编和 C 语言版本。
- `scemi/` 包含编译和仿真处理器的基础设施。
- `src/` 包含 RISC-V 处理器的 BSV 代码。

在 BSV 源文件夹中，有一个 `src/includes/` 文件夹，其中包含用于 RISC-V 处理器的所有模块的 BSV 代码。你在本实验中不需要更改这些文件。这些文件简要说明如下。

| 文件名              | 内容                                               |
| :------------------ | :------------------------------------------------- |
| `Btb.bsv`           | 分支目标缓冲区地址预测器的实现。                   |
| `CsrFile.bsv`       | 实现 CSR（包括与主机机器通信的 `mtohost`）。       |
| `DelayedMemory.bsv` | 实现具有一周期延迟的内存。                         |
| `DMemory.bsv`       | 使用大型寄存器文件实现数据内存，具有组合读写功能。 |
| `Decode.bsv`        | 指令解码的实现。                                   |
| `Ehr.bsv`           | 如讲座中所述，使用 EHRs 实现。                     |
| `Exec.bsv`          | 指令执行的实现。                                   |
| `Fifo.bsv`          | 如讲座中所述，使用 EHRs 实现各种 FIFO。            |
| `IMemory.bsv`       | 使用大型寄存器文件实现具有组合读功能的指令内存。   |
| `MemInit.bsv`       | 模块用于从主机 PC 下载指令和数据存储器的初始内容。 |
| `MemTypes.bsv`      | 与内存相关的常见类型。                             |
| `ProcTypes.bsv`     | 与处理器相关的常见类型。                           |
| `RFile.bsv`         | 寄存器文件的实现。                                 |
| `Types.bsv`         | 常见类型。                                         |

### SceMi 设置

| ![SceMi 设置](http://csg.csail.mit.edu/6.175/archive/2016/labs/lab5/setup.svg) |
| ------------------------------------------------------------ |
| 图 1: SceMi 设置                                             |

图 1 显示了本实验的 SceMi 设置。在设计和调试处理器时，我们经常需要另一个处理器的帮助，我们称之为*宿主*处理器（图 1 中标记为 "Host"）。为了与宿主区分，我们
